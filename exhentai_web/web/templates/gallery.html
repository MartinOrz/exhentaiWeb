<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ title }}</title>
<link rel="stylesheet" type="text/css" href="../../static/css/style.css" />
<link rel="stylesheet" type="text/css" href="../../static/css/ui-dialog.css" />
<script type="text/javascript" src="../../static/js/lib/jquery-3.1.0.min.js"></script>
<script type="text/javascript" src="../../static/js/dialog-plus-min.js"></script>
<script type="text/javascript" src="../../static/js/common.js"></script>
<script type="text/javascript">
    var gid = {{ id }}
    var length = {{ length }}
    var now = {{ first_page }}
    var filter = initFilter()
    function next_gall() {
        $.ajax({
            url: "/gallery?random=1&group=" + getDefaultValue(filter.group) + "&author=" + getDefaultValue(filter.author) + "&tag=" + getDefaultValue(filter.tag) + "&status=" + getDefaultValue(filter.status),
            type: "GET",
            success: function(result) {
                if (result.success) {
                    location.href = "http://{{ host }}:8080/gallery/" + result.data;
                }
            }
        });
    }
    $(document).ready(function() {
        var csrftoken = getCookie('csrftoken');
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        $("img#i").bind("click", function(){
            if (now < length) {
                now += 1
                $("span#now").html(now)
                $(this).attr("src", "http://{{ host }}:8080/gallery/" + gid + "/" + now);
            } else {
                next_gall()
            }
        });
        $("img#f").bind("click", function(){
            now = 1
            $("span#now").html(now)
            $("img#i").attr("src", "http://{{ host }}:8080/gallery/" + gid + "/" + now);
        });
        $("img#p").bind("click", function(){
            if (now > 1) {
                now -= 1
                $("span#now").html(now)
                $("img#i").attr("src", "http://{{ host }}:8080/gallery/" + gid + "/" + now);
            }
        });
        $("img#n").bind("click", function(){
            if (now < length) {
                now += 1
                $("span#now").html(now)
                $("img#i").attr("src", "http://{{ host }}:8080/gallery/" + gid + "/" + now);
            }
        });
        $("img#l").bind("click", function(){
            now = length
            $("span#now").html(now)
            $("img#i").attr("src", "http://{{ host }}:8080/gallery/" + gid + "/" + now);
        });
        $("button#delete").click(function(){
            $.ajax({
                url: "/gallery/" + gid,
                type: "DELETE",
                success: function(result) {
                    // Do something with the result
                }
            });
        });
        $("input#update").click(function(){
            $(this).disabled="disabled"
            $.ajax({
				url: window.location.href,
				type: 'POST',
				data: "rating=" + getDefaultValue($("input#rating").val()) + "&translator=" + getDefaultValue($("input#translator").val()),
				success: function(response){
					if (response.success) {
					    window.location.reload()
					} else {
					    alert("修改失败！")
					}
				}
			});
        });
        $("input#setcof").click(function(){
            var ele = document.getElementById('filter_dialog');
            var d = dialog({
                title: '设置过滤器',
                content: ele,
                ok: function() {
                    filter = {}
                    filter.group = $("#filter_group").val()
                    filter.author = $("#filter_author").val()
                    filter.tag = $("#filter_tag").val()
                    filter.status = $("#filter_status").val()
                    alert("设置成功！")
                }
            });
            d.showModal();
        });
    });
</script>
</head>
<body style="text-align:center">
<div id="header">
    <h1>{{ name_n }}</h1>
    <h1>{{ name_j }}</h1>
</div>
<div id="main">
    <div id="info">
        <div id="info1">
            <table>
                <tbody>
                    <tr>
                        <td class="tdl">类型:</td>
                        <td class="tdr">{{ type }}</td>
                    </tr>
                    <tr>
                        <td class="tdl">语言:</td>
                        <td class="tdr">{{ language }}</td>
                    </tr>
                    <tr>
                        <td class="tdl">长度:</td>
                        <td class="tdr">{{ length }} 页</td>
                    </tr>
                    <tr>
                        <td class="tdl">评分:</td>
                        <td class="tdr">
                            <input class="ir" id="rating" type="number" name="rating" placeholder="请输入评分，0-100." value="{{ rating }}"/>
                        </td>
                    </tr>
                    <tr>
                        <td class="tdl">汉化:</td>
                        <td class="tdr">
                            <input class="ir" id="translator" type="text" name="translator" placeholder="请输入汉化组" value="{{ translator }}"/>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="wl"></div>
            <div id="submit">
                <input class="ib" id="setcof" type="submit" value="设置过滤">
                <input class="ib" id="update" type="submit" value="提交更改">
                <input class="ib" id="delete" type="submit" value="删除画集">
            </div>
        </div>
        <div id="info2">
            <table>
                <tbody>
                    {%if authors%}
                    <tr>
                        <td class="tagtdl">作者:</td>
                        <td class="tagtdr">
                            {% for author in authors %}
                            <div class="tag" style="opacity:1.0"><a title="ttt">{{ author.name }}</a></div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {%if groups%}
                    <tr>
                        <td class="tagtdl">团体:</td>
                        <td class="tagtdr">
                            {% for group in groups %}
                            <div class="tag" style="opacity:1.0"><a title="ttt">{{ group.name }}</a></div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {%if male_tags%}
                     <tr>
                        <td class="tagtdl">男性:</td>
                        <td class="tagtdr">
                            {% for tag in male_tags %}
                            <div class="tag" style="opacity:1.0">{{ tag.name }}</div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {%if female_tags%}
                    <tr>
                        <td class="tagtdl">女性:</td>
                        <td class="tagtdr">
                            {% for tag in female_tags %}
                            <div class="tag" style="opacity:1.0">{{ tag.name }}</div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {%if misc_tags%}
                    <tr>
                        <td class="tagtdl">其他:</td>
                        <td class="tagtdr">
                            {% for tag in misc_tags %}
                            <div class="tag" style="opacity:1.0">{{ tag.name }}</div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    <div id="image">
        <div id="comic_img">
            <image id="i" src="http://{{ host }}:8080/gallery/{{ id }}/{{ first_page }}"/>
        </div>
    </div>
    <div id="footer">
        <img id="f" src="../../static/resources/first_page.png" />
        <img id="p" src="../../static/resources/pre_page.png" />
        <div><span id="now">1</span> / <span>{{ length }}</span></div>
        <img id="n" src="../../static/resources/next_page.png" />
        <img id="l" src="../../static/resources/last_page.png" />
    </div>
</div>
<div id="filter_dialog" style="display: none">
    <table>
        <tbody>
            <tr>
                <td>团体:</td><td><input id="filter_group"></td>
            </tr>
            <tr>
                <td>作者:</td><td><input id="filter_author"></td>
            </tr>
            <tr>
                <td>标签:</td><td><input id="filter_tag"></td>
            </tr>
            <tr>
                <td>状态:</td><td><input id="filter_status"></td>
            </tr>
        </tbody>
    </table>
</div>
</body>

</html>